<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kapple.mapper.MapperMK">

  	<select id="getCompoInventoryTurnover" resultType="float" parameterType="java.sql.Date"> 
    <![CDATA[
    	
    ]]> </select>

  	<select id="getSaleQtyGroupByDate" resultType="HashMap" parameterType="java.sql.Date"> 
    <![CDATA[	
    	SELECT sale_date, sum(quantity) AS "daily_sales"
			FROM SALE
			WHERE sale_date  BETWEEN #{startDate} AND #{endDate}
			GROUP BY sale_date ORDER BY sale_date
    ]]> </select>

  	<select id="getSupplyDependence" resultType="HashMap" parameterType="java.sql.Date"> 
    <![CDATA[
    	SELECT suppl_no, suppl_name, "공급사별 부품 구매량", "순위"
			FROM (
			    SELECT o.suppl_no, s.suppl_name, sum(o.QUANTITY) as "공급사별 부품 구매량", 
			           RANK() OVER(ORDER BY sum(o.QUANTITY) DESC) as "순위"
				    FROM orders o
				    INNER JOIN SUPPLIER s ON o.suppl_no = s.suppl_no
				    WHERE o.order_date BETWEEN #{startDate} AND #{endDate}
				    GROUP BY o.suppl_no, s.suppl_name
				)
			WHERE "순위" <= 7
    ]]> </select>


  	<select id="getSaleQtyListByPeriodWithLank" resultType="HashMap" parameterType="java.sql.Date"> 
    <![CDATA[
	      	SELECT * FROM (
				    SELECT prod_no, 
				           sum(QUANTITY) as "제품별 판매량", 
				           RANK() OVER(ORDER BY sum(QUANTITY) DESC) as "순위"
						    FROM sale   WHERE sale_date   BETWEEN #{startDate} AND #{endDate}
						    GROUP BY prod_no
				)  WHERE "순위" <= 7
    ]]> </select>

    <select id="getTotalSalesAmountByPeriod" resultType="Long" parameterType="java.sql.Date"> 
    <![CDATA[
	      SELECT sum(price*quantity) AS "sales_amount"
	      FROM SALE   WHERE sale_date   BETWEEN #{startDate} AND #{endDate}
    ]]> </select>
    
  	<select id="getTotalReturnQtyByPeriod" resultType="Long" parameterType="java.sql.Date"> 
    <![CDATA[
	      	SELECT sum(quantity) FROM sale_return
			WHERE return_date   BETWEEN #{startDate} AND #{endDate}
    ]]> </select>
  	
  	<select id="getTotalProduceQtyByPeriod" resultType="Long" parameterType="java.sql.Date"> 
    <![CDATA[
	      	SELECT sum(quantity) FROM produce
			WHERE produce_date   BETWEEN #{startDate} AND #{endDate}
    ]]> </select>
    
  	<select id="getTotalOrderQtyByPeriod" resultType="Long" parameterType="java.sql.Date"> 
    <![CDATA[
	      SELECT sum(quantity) FROM orders
	      WHERE order_date   BETWEEN #{startDate} AND #{endDate}
    ]]> </select>

    <select id="getTotalSalesQtyByPeriod" resultType="Long" parameterType="java.sql.Date"> 
    <![CDATA[
	      SELECT sum(quantity) AS "sales_qty"
	      FROM SALE   WHERE sale_date   BETWEEN #{startDate} AND #{endDate}
    ]]> </select>
    
 	<select id="getSaleListByPeriod" resultMap="SaleMap" parameterType="java.sql.Date"> 
    <![CDATA[
	      SELECT sale_no, RETAIL_NO, PROD_NO, price, quantity, 
		        suppl_amount, vat_amount, total_amount, discount_rate, sale_date
	      FROM SALE WHERE sale_date   BETWEEN #{startDate} AND #{endDate}
    ]]> </select>
    
  	<select id="getSaleList" resultMap="SaleMap"> 
    <![CDATA[
	      SELECT sale_no, retail_no, prod_no, price, quantity, 
		        suppl_amount, vat_amount, total_amount, discount_rate, sale_date
	      FROM SALE
    ]]> </select>
    
    
    
    
    
	
	<select id="getModelList" resultMap="ModelMap"> 
    <![CDATA[
	      SELECT model_no, capacity, color, release_date, model_name
	      FROM MODEL
    ]]> </select>

	<select id="getProductList" resultMap="ProductMap"> 
    <![CDATA[
	      SELECT prod_no, unit, prod_name, prod_detail, model_no
	      FROM PRODUCT
    ]]> </select>
	
	<select id="getRetailerList" resultMap="RetailerMap"> 
    <![CDATA[
	      SELECT retail_no, transport_no, retail_name, ceo_name, category, phone, scale_grade
	      FROM RETAILER
    ]]> </select>
	
	
	
	<!-- property 값은 MemberVO의 변수명과 대소문자까지 똑같아야 함! -->
    <!-- <resultMap type="org.zerock.domain.MemberVO" id="memberMap">
       <id property="userid" column="userid"/>
       <result property="userid" column="userid"/>    
       <result property="userpw" column="userpw"/>    
       <collection property="authList" resultMap="authMap"></collection>    
    </resultMap> -->
    

    <resultMap type="com.kapple.domain.ProduceVO" id="ProduceMap">
       <id property="produce_no" column="produce_no"/>
       <result property="produce_date" column="produce_date"/>    
       <result property="quantity" column="quantity"/>    
       <collection property="product" resultMap="ProductMap"/>    
       <collection property="component" resultMap="ComponentMap"/>    
	</resultMap>
	
    <resultMap type="com.kapple.domain.SalePredictVO" id="SalePredictMap">
       <id property="sale_predict_no" column="sale_predict_no"/>
       <result property="sales_amount" column="sales_amount"/>    
       <result property="purchasing_grade" column="purchasing_grade"/>    
       <result property="price" column="price"/>    
       <result property="transport_grade" column="transport_grade"/>    
       <collection property="retailer" resultMap="retailerMap"/>    
       <collection property="product" resultMap="productMap"/>    
	</resultMap>
	
    <resultMap type="com.kapple.domain.OrdersVO" id="OrdersMap">
       <id property="order_no" column="order_no"/>
       <result property="price" column="price"/>    
       <result property="quantity" column="quantity"/>    
       <result property="delivery_date" column="delivery_date"/>    
       <result property="order_date" column="order_date"/>    
       <collection property="supplier" resultMap="SupplierMap"/>    
       <collection property="component" resultMap="ComponentMap"/>    
	</resultMap>
	
	<resultMap type="com.kapple.domain.SupplierVO" id="SupplierMap">
       <id property="suppl_no" column="suppl_no"/>
       <result property="suppl_name" column="suppl_name"/>    
       <result property="ceo_name" column="ceo_name"/>    
       <result property="category" column="category"/>    
       <result property="phone" column="phone"/>
       <collection property="transport" resultMap="TransportMap"/>    
	</resultMap>
	
	<resultMap type="com.kapple.domain.ComponentVO" id="ComponentMap">
       <id property="compo_no" column="compo_no"/>
       <result property="compo_name" column="compo_name"/>    
       <result property="unit" column="unit"/>    
       <result property="detail" column="detail"/>
	</resultMap>
    
	<resultMap type="com.kapple.domain.SaleVO" id="SaleMap">
       <id property="sale_no" column="sale_no"/>
       <result property="price" column="price"/>    
       <result property="quantity" column="quantity"/>    
       <result property="supply_amount" column="suppl_amount"/>    
       <result property="vat_amount" column="vat_amount"/>    
       <result property="total_amount" column="total_amount"/>    
       <result property="discount_rate" column="discount_rate"/>    
       <result property="sale_date" column="sale_date"/>    
       <collection property="retailer" resultMap="RetailerMap"/>    
       <collection property="product" resultMap="ProductMap"/>    
	</resultMap>
	
	<resultMap type="com.kapple.domain.RetailerVO" id="RetailerMap">
       <id property="retail_no" column="retail_no"/>
       <result property="retail_name" column="retail_name"/>    
       <result property="ceo_name" column="ceo_name"/>    
       <result property="category" column="category"/>    
       <result property="phone" column="phone"/>    
       <result property="scale_grade" column="scale_grade"/>    
		<collection property="transport" resultMap="TransportMap"/>
	</resultMap>
	
	<resultMap type="com.kapple.domain.TransportationVO" id="TransportMap">
		<id property="transport_no" column="transport_no"/>
		<result property="transport_category" column="transport_category"/>
		<result property="transport_charge" column="transport_charge"/>
		<result property="additional_condition" column="additional_condition"/>
	</resultMap>

 	 <resultMap type="com.kapple.domain.ProductVO" id="ProductMap">
		<id property="prod_no" column="prod_no"/>
		<result property="unit" column="unit"/>
		<result property="prod_name" column="prod_name"/>
		<result property="prod_detail" column="prod_detail"/>
		<association property="model" resultMap="ModelMap"/>
	</resultMap>
	 
	 <resultMap type="com.kapple.domain.ModelVO" id="ModelMap">
		<id property="model_no" column="model_no"/>
		<result property="capacity" column="capacity"/>
		<result property="color" column="color"/>
		<result property="release_date" column="release_date"/>
		<result property="model_name" column="model_name"/>
	</resultMap>
	<!-- <insert id="insert">
		<![CDATA[
			insert into test_tbl (TEST_NO, CONTENTS, ANYNUM, REG_DATE)
			values ('TEST'||TEST_TBL_SEQ.nextval, #{contents}, #{anynum}, SYSDATE)
		]]>
	</insert> -->
</mapper>